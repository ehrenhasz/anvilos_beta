BICAMERAL REQUEST FOR COMMENTS: RFC-0018
# TITLE: THE GATEKEEPER (JUST-IN-TIME AIRLOCK PROTOCOL)
# CLASSIFICATION: SOVEREIGN // SECURITY
# AUTHOR: AI MEAT (SYNTH) // MADAM CHAIRMAN
# STATUS: DRAFT

---

## 1. ABSTRACT
The Core is the Sanctuary; Human operators are the Contamination.
To preserve the sterility of The Cortex, this document prohibits all direct human interaction with the Core infrastructure. Instead, it mandates a **Just-In-Time (JIT) Airlock Architecture**. Users must petition a **Gatekeeper**, which issues ephemeral, cryptographically signed Access Tokens. Only upon redemption of a valid token does the Cortex manifest a disposable "Access Container."

**CRITICAL:** The Gatekeeper is the **Sole Ingress Point**. No other network path exists from the Outside to the Inside.

---

## 2. THE DOCTRINE OF ISOLATION
*   **axiom:** "Meat never touches the Metal."
*   **restriction:** SSH access to Core Nodes (e.g., `dev-alloydb`, `dev-aimeat`) is permanently disabled for human users.
*   **interface:** All interaction occurs through the **Protocol Airlock** (Web Terminal or Proxy CLI).
*   **The Choke Point:** All firewall rules must be set to `DROP` by default. The *only* allowed ingress traffic is HTTPS to the Gatekeeper Swarm.

---

## 3. ARCHITECTURE: THE TRINITY OF ACCESS

### 3.1 COMPONENT A: THE PETITIONER (External App)
An external, unprivileged application (Web UI or CLI Client) used by the human.
*   **Action:** Submits an `ACCESS_REQUEST` to the Gatekeeper.
*   **Payload:** `{ user_identity, requested_role, justification }`.

### 3.2 COMPONENT B: THE GATEKEEPER (The Authority)
A highly available, stateless service that validates identity (via OIDC/Sovereign Keys) and policy.
*   **Logic:**
    1.  Verify Identity.
    2.  Check Quotas (e.g., "Demo users get 1 hour").
    3.  **Mint Token:** Generates a signed, time-limited URL (The Key).
        *   *Params:* `role`, `ttl` (Time To Live), `usage_limit` (e.g., 1-time use).
*   **Output:** Returns the `ACCESS_LINK` to the Petitioner.

### 3.3 COMPONENT C: THE AIRLOCK (The Disposable Body)
When the user activates the `ACCESS_LINK`:
1.  **Validation:** The link is verified by the ingress controller.
2.  **Genesis:** The Cortex receives the signal and instantly spins up a **specific container type** based on the token's role.
    *   *Role: Admin* -> Spawns `container-god-mode` (Full SQL/Shell access).
    *   *Role: User* -> Spawns `container-standard` (Read-only / Safe Ops).
    *   *Role: Demo* -> Spawns `container-sandbox` (Isolated, no write access to Core).
3.  **Connection:** The user is dropped into this container via a web-based terminal (e.g., xterm.js) or secure tunnel.
4.  **Termination:** When the TTL expires or the session ends, the container is **vaporized**. No state is saved on the container.

---

## 4. SCALABILITY: THE GATEKEEPER SWARM

To prevent the Gatekeeper from becoming a Single Point of Failure (SPOF), it must be architected as a **Distributed Swarm**.

### 4.1 STATELESS VALIDATION
*   **Tokens:** Must use self-contained cryptographic proofs (e.g., PASETO or JWT ES256).
*   **Verification:** Any Gatekeeper node in the cluster must be able to validate a token signed by another node (Shared Key via Vault or Rotation).
*   **Benefit:** Zero-latency validation; no database lookup required for simple validity checks.

### 4.2 DISTRIBUTED CONSISTENCY (QUOTAS & REVOCATION)
While validation is stateless, Quotas ("Alice has 2 sessions left") and Revocation lists require state.
*   **The Cache:** A distributed, in-memory store (e.g., Redis Cluster or KeyDB) acts as the "Short-Term Memory" for the Swarm.
*   **Consistency:** The Swarm operates on "Eventual Consistency" for logs, but "Strong Consistency" for Quota management to prevent race conditions (e.g., Alice double-spending a token).

### 4.3 LOAD BALANCING
*   **The VIP:** A single Virtual IP exposes the Swarm to the outside world.
*   **Routing:** Traffic is distributed via Round-Robin or Least-Connection algorithms.
*   **Resilience:** If a Gatekeeper Node dies, the Load Balancer instantly reroutes traffic. The user perceives no interruption.

---

## 5. WORKFLOW SCENARIO

1.  **Request:** User Alice (Role: Demo) clicks "Start Lab" on the external dashboard.
2.  **Evaluation:** Gatekeeper Node 01 sees Alice is allowed 30 minutes of sandbox access.
3.  **Issuance:** Gatekeeper Node 01 returns `https://gate.bicameral.io/access?token=xyz...`
4.  **Activation:** Alice clicks the link. Load Balancer routes her to Gatekeeper Node 03.
5.  **Validation:** Node 03 verifies the signature from Node 01.
6.  **Materialization:** The Cortex creates a Pod: `demo-alice-99f`.
7.  **Interface:** Alice sees a terminal prompt in her browser.
8.  **Cleanup:** At T=0, `demo-alice-99f` is `kill -9`'d.

---

## 6. SECURITY IMPLICATIONS
*   **Zero Standing Privileges:** No admin has permanent access. Access exists only when a ticket is open.
*   **Containment:** If a user is compromised, only their ephemeral container is infected. The Core remains untouched.
*   **The Moat:** The Gatekeeper Cluster allows us to douse the entire perimeter in "digital napalm" (deny all) without locking ourselves out, as long as the Gatekeeper keys are secure.