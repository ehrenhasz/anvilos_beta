// INITIATING STREAM FOR: Create a shell script to cross-compile OpenZFS userspace tools using the musl toolchain in ext/toolchain. Target: x86_64. Output to ext/build/rootfs/bin.
[
  {
    "instruction": "SYSTEM_OP",
    "details": "#!/bin/bash\n\nset -eux\n\n# Define variables\nexport ARCH=\"x86_64\"\nexport CROSS_COMPILE=\"x86_64-linux-musl-\"\nexport MUSL_PATH=\"ext/toolchain/musl-${ARCH}\"\nexport DESTDIR=\"ext/build/rootfs\"\nexport PREFIX=\"/\"\nexport JOBS=\"$(nproc)\"\n\n# Source the toolchain environment\n# shellcheck source=/dev/null\nsource \"ext/toolchain/toolchain.sh\"\n\n# Create destination directory\nmkdir -p \"${DESTDIR}/bin\"\n\n# Configure and build OpenZFS userspace tools\n./configure \\\n    --prefix=\"${PREFIX}\" \\\n    --exec-prefix=\"${PREFIX}\" \\\n    --bindir=\"${PREFIX}/bin\" \\\n    --sbindir=\"${PREFIX}/sbin\" \\\n    --libdir=\"${PREFIX}/lib\" \\\n    --sysconfdir=\"${PREFIX}/etc\" \\\n    --with-config-dir=\"${PREFIX}/etc/zfs\" \\\n    --with-module-dir=\"${PREFIX}/lib/modules\" \\\n    --with-udev-dir=\"${PREFIX}/lib/udev\" \\\n    --with-systemd-dir=\"${PREFIX}/lib/systemd\" \\\n    --with-init-dir=\"${PREFIX}/etc/init.d\" \\\n    --with-mount-dir=\"${PREFIX}/sbin\" \\\n    --with-cross-compile=\"yes\" \\\n    --with-linux=\"/usr/src/linux\" \\\n    --with-spl=\"../spl\" \\\n    --host=\"${CROSS_COMPILE::-1}\" \\\n    --disable-dependency-tracking \\\n    --disable-silent-rules\n\nmake -j \"${JOBS}\"\nmake install DESTDIR=\"${DESTDIR}\"\n\n# Verify that zfs is in the output directory\nif [ ! -f \"${DESTDIR}/bin/zfs\" ]; then\n  echo \"Error: zfs binary not found in ${DESTDIR}/bin\"\n  exit 1\nfi\n\necho \"OpenZFS userspace tools cross-compiled successfully to ${DESTDIR}\"\n",
    "format": "shell"
  }
]